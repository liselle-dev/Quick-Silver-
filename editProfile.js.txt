// editProfile.js
import { dynamoDB, cognito } from './aws-setup';

export const editProfile = async (email, updatedData) => {
  await dynamoDB.update({
    TableName: process.env.DYNAMODB_TABLE_NAME,
    Key: {
      PK: `USER#${email}`,
      SK: 'PROFILE',
    },
    UpdateExpression: 'set #n = :n, phone = :p, address = :a',
    ExpressionAttributeNames: { '#n': 'name' },
    ExpressionAttributeValues: {
      ':n': updatedData.name,
      ':p': updatedData.phone,
      ':a': updatedData.address,
    },
  }).promise();

  await cognito.adminUpdateUserAttributes({
    UserPoolId: process.env.COGNITO_USER_POOL_ID,
    Username: email,
    UserAttributes: [
      { Name: 'name', Value: updatedData.name },
    ],
  }).promise();

  return { success: true, message: 'Profile updated successfully' };
};
