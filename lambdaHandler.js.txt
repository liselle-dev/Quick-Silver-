// lambdaHandler.js
import { createUser } from './createUser';
import { signIn } from './signIn';
import { editProfile } from './editProfile';
import { processPayment } from './paymentProcessor';

export const handler = async (event) => {
  const { httpMethod, path } = event;
  let body = {};

  try {
    if (event.body) {
      body = JSON.parse(event.body);
    }

    // Route logic
    if (path === '/createUser' && httpMethod === 'POST') {
      return response(await createUser(body.email, body.password, body.name));
    }

    if (path === '/signIn' && httpMethod === 'POST') {
      return response(await signIn(body.email, body.password));
    }

    if (path === '/editProfile' && httpMethod === 'PUT') {
      return response(await editProfile(body.email, body.updatedData));
    }

    if (path === '/processPayment' && httpMethod === 'POST') {
      return response(await processPayment(body));
    }

    // Default: route not found
    return response({ success: false, message: 'Route not found' }, 404);

  } catch (error) {
    console.error('Handler error:', error);
    return response({ success: false, message: 'Internal Server Error' }, 500);
  }
};

// Helper: format API Gateway response
const response = (body, statusCode = 200) => ({
  statusCode,
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(body),
});
