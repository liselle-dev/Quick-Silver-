Backend Modules (Java / Spring Boot)

GeofenceController.java


package com.quicksilver.toll;

import org.springframework.web.bind.annotation.*;
import software.amazon.awssdk.regions.Region;
import software.amazon.awssdk.services.location.LocationClient;
import software.amazon.awssdk.services.location.model.*;

import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/checkGeofence")
public class GeofenceController {

    private static final String COLLECTION_NAME = "QuickSilver_Geofense";

    private final LocationClient locationClient =
            LocationClient.builder()
                    .region(Region.US_EAST_2)
                    .build();

    @PostMapping
    public Map<String, Boolean> checkGeofence(@RequestBody LocationRequest request) {

        BatchEvaluateGeofencesRequest geoRequest =
                BatchEvaluateGeofencesRequest.builder()
                        .collectionName(COLLECTION_NAME)
                        .devicePositionUpdates(
                                Map.of(
                                        "vehicle",
                                        DevicePositionUpdate.builder()
                                                .position(List.of(
                                                        request.getLongitude(),
                                                        request.getLatitude()
                                                ))
                                                .build()
                                )
                        )
                        .build();

        BatchEvaluateGeofencesResponse response =
                locationClient.batchEvaluateGeofences(geoRequest);

        boolean isInside =
                response.devicePositions()
                        .get("vehicle")
                        .geofenceMatches()
                        .size() > 0;

        return Map.of("isInGeofence", isInside);
    }
}
